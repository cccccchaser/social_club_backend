webpackJsonp([0],{"0HiU":function(t,e,a){"use strict";var s=a("Dd8w"),n=a.n(s),i=a("hQg6"),o=a.n(i),l=a("ZxXG"),c=a("90m7"),m=a("NYxO"),d={mixins:[c.a],props:{data:{type:Object,default:null},belong:{type:String,default:""}},computed:n()({},Object(m.e)(["authUserInfo"])),data:function(){return{defaultAvatar:void 0,hasRestSubComment:!1,showSubInput:!1,subInputText:"",subComments:[]}},methods:{deleteThis:function(){var t=this;this.$confirm("你确定要删除此评论吗",{lockScroll:!1,type:"warning"}).then(function(){t.$emit("delete")}).catch(function(){})},deleteReply:function(t,e){var a=this;this.$confirm("你确定要删除此回复吗",{lockScroll:!1,type:"warning"}).then(function(){(new l.a).deleteReply(a.data._id,t).then(function(t){a.$emit("hasDeleteReply"),a.subCommentsOrigin.splice(e,1),a.subComments.splice(e,1),a.$message({message:"删除成功！",lockScroll:!1,type:"success"})})}).catch(function(){})},toggleSubInput:function(){this.checkLoginBeforeAction()&&(this.showSubInput=!this.showSubInput)},collapseReply:function(){this.subCommentsOrigin.length!==this.subComments.length?this.subComments=this.subCommentsOrigin.slice(0):this.subComments=this.subCommentsOrigin.slice(0,2)},goReplyComment:function(){var t=this;this.checkLoginBeforeAction()&&(this.subInputText&&(new l.a).replyComment(this.data._id,this.subInputText,this.belong).then(function(e){var a=e.data.data;a.author={_id:a.author,nickname:t.authUserInfo.nickname},t.subCommentsOrigin.length===t.subComments.length&&t.subComments.push(a),t.subCommentsOrigin.push(a),t.subInputText="",t.$emit("hasReply"),t.$message({message:"回复成功",type:"success",lockScroll:!1})}))}},created:function(){this.defaultAvatar=o.a,this.subCommentsOrigin=this.data.sub_comments?this.data.sub_comments.slice(0):[],this.subComments=this.data.sub_comments?this.data.sub_comments.slice(0,2):[],this.hasRestSubComment=this.data.sub_comments.length>2}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment-item"},[a("div",{staticClass:"avatar-box"},[a("img",{attrs:{src:t.data.author.avatar||t.defaultAvatar,alt:"avatar"}})]),t._v(" "),a("div",{staticClass:"main-box"},[a("div",{staticClass:"content"},[a("router-link",{staticClass:"name",attrs:{to:"/user?id="+t.data.author._id}},[t._v(t._s(t.data.author.nickname)+"：")]),t._v(" "),a("span",{staticClass:"comment-content",domProps:{innerHTML:t._s(t.data.content)}})],1),t._v(" "),a("div",{staticClass:"foot-box"},[a("span",{staticClass:"date"},[t._v(t._s(t.getDateDict(t.data.created_at)))]),t._v(" "),a("div",{staticClass:"corner"},[t.authUserInfo.id===t.data.author._id?a("span",{staticClass:"delete-btn",on:{click:t.deleteThis}},[t._v("删除")]):t._e(),t._v(" "),a("span",{staticClass:"reply-btn",on:{click:t.toggleSubInput}},[t._v("回复")])])]),t._v(" "),t.showSubInput?a("div",{staticClass:"sub-input-box"},[a("el-input",{attrs:{size:"mini",maxlength:"100"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.goReplyComment(e)}},model:{value:t.subInputText,callback:function(e){t.subInputText=e},expression:"subInputText"}}),t._v(" "),a("el-button",{staticClass:"sub-reply-btn",attrs:{size:"mini",type:"primary"},on:{click:t.goReplyComment}},[t._v("回复")])],1):t._e(),t._v(" "),t.subComments.length?a("div",{staticClass:"sub-comment-box"},[t._l(t.subComments,function(e,s){return a("div",{key:e._id,staticClass:"sub-comment-item"},[a("router-link",{staticClass:"name",attrs:{to:"/user?id="+e.author._id}},[t._v(t._s(e.author.nickname)+"：")]),t._v(" "),a("span",{staticClass:"comment-content",domProps:{innerHTML:t._s(e.content)}}),t._v(" "),e.author._id===t.authUserInfo.id?a("span",{staticClass:"delete-reply",on:{click:function(a){return t.deleteReply(e._id,s)}}},[t._v("删除")]):t._e(),t._v(" "),a("div",{staticClass:"date"},[t._v(t._s(t.getDateDict(e.created_at)))])],1)}),t._v(" "),t.hasRestSubComment&&t.subComments.length?a("div",{staticClass:"collapse-reply",on:{click:t.collapseReply}},[t._v("\n          "+t._s(t.subComments.length===t.subCommentsOrigin.length?"收起":"展开剩余"+(t.subCommentsOrigin.length-t.subComments.length)+"条回复")+"\n        ")]):t._e()],2):t._e()])])},staticRenderFns:[]};var u=a("VU/8")(d,r,!1,function(t){a("Vxn5")},"data-v-90d29ee8",null).exports,h=a("AJBx"),p=a("YMNS"),v={mixins:[c.a],props:{data:{type:Object,required:!0},hideFollowBtn:{type:Boolean,default:!1},hideDeleteBtn:{type:Boolean,default:!1}},components:{CommentItem:u,Loading:h.a,ClickMore:p.a},data:function(){return{defaultAvatar:void 0,showCommentPanel:!1,inputComment:"",hasLiked:void 0,displayLike:void 0,displayComment:void 0,showFollowedButton:void 0,comments:[],commentPage:1,commentListSize:10,isLoadingComment:!0,loadCommentCompleted:!1}},computed:n()({},Object(m.e)(["authUserInfo"])),methods:{photosAdapter:function(t,e){var a=this.$refs["photos"+e][0];if(this.data.images&&this.data.images.length>1)a.style.opacity=1;else{var s=a.width,n=a.height;n>s?(a.height=250,a.width=250/n*s):s>300&&(a.width=300,a.height=300/s*n),a.style.opacity=1}},deleteThis:function(){var t=this;this.$confirm("确定要删除此动态吗",{lockScroll:!1,type:"warning"}).then(function(){t.$emit("delete")}).catch(function(){})},toggleCommentPanel:function(){this.showCommentPanel?(this.comments=[],this.commentPage=1,this.loadCommentCompleted=!1):this.loadComments(),this.showCommentPanel=!this.showCommentPanel},toggleLike:function(){if(this.checkLoginBeforeAction()){var t=parseInt(this.displayLike),e=this.hasLiked?"cancel":"like",a=new l.a;this.hasLiked?this.displayLike=t-1||"喜欢":this.displayLike=isNaN(t)?1:t+1,a.likeMoment(this.data._id,e),this.hasLiked=!this.hasLiked}},toggleFollow:function(){var t=this;this.checkLoginBeforeAction()&&(this.data.author.hasFollowed?this.$confirm("确定要取消关注此用户吗",{lockScroll:!1,type:"warning"}).then(function(){t.$emit("toggleFollow","cancel")}).catch(function(){}):this.$emit("toggleFollow","follow"))},updateCommentDisplay:function(t){var e=parseInt(this.displayComment);this.displayComment=t>0?isNaN(e)?1:e+1:this.displayComment-1||"评论"},deleteComment:function(t,e){var a=this;(new l.a).deleteComment(this.data._id,t).then(function(){a.comments.splice(e,1),a.updateCommentDisplay(-1),a.$message({message:"删除评论成功！",type:"success"})})},goComment:function(){var t=this;this.checkLoginBeforeAction()&&(this.inputComment?(new l.a).commentMoment(this.data._id,this.inputComment).then(function(e){var a=e.data.data;a.author={_id:a.author,avatar:t.authUserInfo.avatar,nickname:t.authUserInfo.nickname},t.$message({message:"评论成功！",type:"success"}),t.comments.push(a),t.updateCommentDisplay(1),t.inputComment=""}):this.$alert("请输入评论内容",{type:"warning",lockScroll:!1}))},loadComments:function(){var t=this;this.loadCommentCompleted||(this.isLoadingComment=!0,(new l.a).getMomentComment(this.data._id,this.commentPage,this.commentListSize).then(function(e){var a=e.data.data;t.comments=t.comments.concat(a),t.isLoadingComment=!1,t.commentPage++,a.length<t.commentListSize&&(t.loadCommentCompleted=!0)}))}},mounted:function(){this.hasLiked=this.data.hasLiked,this.displayLike=this.data.likes_num||"喜欢",this.displayComment=this.data.comments_num||"评论",this.showFollowedButton=!this.hideFollowBtn&&("hasFollowed"in this.data.author&&!this.data.author.hasFollowed)},created:function(){this.defaultAvatar=o.a}},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("article",{staticClass:"social-moment"},[a("div",{staticClass:"avatar-box"},[a("img",{attrs:{src:t.data.author.avatar||t.defaultAvatar,alt:"avatar"}})]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content-head"},[a("div",{staticClass:"head-info"},[a("h4",[a("router-link",{attrs:{to:"/user?id="+t.data.author._id}},[t._v(t._s(t.data.author.nickname))])],1),t._v(" "),a("h5",[t._v(t._s(t.getDateDict(t.data.created_at)))])]),t._v(" "),t.showFollowedButton?a("el-button",{staticClass:"follow-btn",attrs:{size:"mini",type:t.data.author.hasFollowed?"":"primary",icon:t.data.author.hasFollowed?"":"el-icon-plus",plain:t.data.author.hasFollowed},on:{click:t.toggleFollow}},[t._v(t._s(t.data.author.hasFollowed?"已关注":"关注"))]):t._e()],1),t._v(" "),a("div",{staticClass:"content-body"},[a("p",{domProps:{innerHTML:t._s(t.data.content)}}),t._v(" "),t.data.images.length?a("div",{staticClass:"media-img-box"},[a("viewer",{attrs:{images:t.data.images,static:""}},t._l(t.data.images,function(e,s){return a("div",{key:s,staticClass:"media-img",class:t.data.images.length>1?"normal":"single"},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e,expression:"item"}]})])}),0)],1):t._e(),t._v(" "),t.data.video?a("div",{staticClass:"media-video-box"},[a("video",{ref:"socialVideo",attrs:{src:t.data.video,controls:""}})]):t._e()]),t._v(" "),a("ul",{staticClass:"control-bar"},[a("li",{on:{click:t.toggleCommentPanel}},[a("i",{staticClass:"fa fa-comments-o"}),t._v(" "),a("span",[t._v(t._s(t.displayComment))])]),t._v(" "),a("li",{on:{click:t.toggleLike}},[a("i",{staticClass:"fa fa-thumbs-o-up",class:t.hasLiked?"fa-thumbs-up":"fa-thumbs-o-up"}),t._v(" "),a("span",[t._v(t._s(t.displayLike))])])]),t._v(" "),t.data.author._id!==t.authUserInfo.id||t.hideDeleteBtn?t._e():a("div",{staticClass:"delete-btn el-icon-error",on:{click:t.deleteThis}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showCommentPanel,expression:"showCommentPanel"}],staticClass:"comment-panel"},[a("div",{staticClass:"input-box"},[a("el-input",{attrs:{type:"textarea",rows:"2",maxlength:"100"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.goComment(e)}},model:{value:t.inputComment,callback:function(e){t.inputComment=e},expression:"inputComment"}}),t._v(" "),a("el-button",{staticClass:"comment-btn",attrs:{type:"primary",size:"mini"},on:{click:t.goComment}},[t._v("评论")])],1),t._v(" "),a("div",{staticClass:"comment-list"},[a("Loading",{attrs:{size:"small",loading:t.isLoadingComment&&!t.comments.length}}),t._v(" "),a("ClickMore",{attrs:{loading:t.isLoadingComment,completed:t.loadCommentCompleted,useCardLayout:!1,noMoreText:"已无更多评论"},on:{loadMore:t.loadComments}},t._l(t.comments,function(e,s){return a("comment-item",{key:e._id,staticClass:"comment-item",attrs:{data:e,belong:t.data._id},on:{hasReply:function(e){return t.updateCommentDisplay(1)},hasDeleteReply:function(e){return t.updateCommentDisplay(-1)},delete:function(a){return t.deleteComment(e._id,s)}}})}),1)],1)])])])},staticRenderFns:[]};var g=a("VU/8")(v,C,!1,function(t){a("Wipg")},"data-v-26ad3f4a",null);e.a=g.exports},"3kcw":function(t,e){},"47cX":function(t,e){},AJBx:function(t,e,a){"use strict";var s={props:{loading:{type:Boolean,default:!1},size:{type:String,default:"default"}},computed:{loadingSizeClass:function(){return"size-"+this.size}}},n={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"social-loading"},[this.loading?e("div",{staticClass:"loading-wrapper",class:this.loadingSizeClass},[e("i",{staticClass:"el-icon-loading"})]):this._e()])},staticRenderFns:[]};var i=a("VU/8")(s,n,!1,function(t){a("47cX")},"data-v-cf6cf32a",null);e.a=i.exports},Vxn5:function(t,e){},Wipg:function(t,e){},YMNS:function(t,e,a){"use strict";var s={props:{loading:{type:Boolean,default:!1},completed:{type:Boolean,default:!1},useCardLayout:{type:Boolean,default:!0},noMoreText:{type:String,default:"加载完毕，已无更多数据"}},computed:{tipClassStyle:function(){return this.useCardLayout?"card":""}},methods:{clickMore:function(){this.completed||this.$emit("loadMore")}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("figure",[t._t("default"),t._v(" "),t.loading||t.completed?t._e():a("div",{staticClass:"to-click",class:t.tipClassStyle,on:{click:t.clickMore}},[t._v("点击加载更多")]),t._v(" "),t.loading&&!t.completed?a("div",{staticClass:"is-loading",class:t.tipClassStyle},[t._v("正在玩命加载中")]):t._e(),t._v(" "),!t.loading&&t.completed?a("div",{staticClass:"no-more",class:t.tipClassStyle},[t._v(t._s(t.noMoreText))]):t._e()],2)},staticRenderFns:[]};var i=a("VU/8")(s,n,!1,function(t){a("3kcw")},"data-v-3719212c",null);e.a=i.exports}});